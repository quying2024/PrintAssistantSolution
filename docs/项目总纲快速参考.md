# PrintAssistant 项目总纲快速参考

## 🎯 项目总纲性文件

**《托盘打印助手PrintAssistant项目规划01.md》** - 项目的行动总纲和架构蓝图

## 📋 核心架构要点

### 1. 托管模型
- **.NET通用主机**：服务驱动的现代化架构
- **依赖注入**：Microsoft.Extensions.DependencyInjection
- **配置管理**：Options模式 + appsettings.json
- **日志系统**：Serilog结构化日志

### 2. 核心服务架构
```
IHostedService (PrintProcessorService) - 主处理服务
├── IFileMonitor (FileMonitorService) - 文件监控
├── IPrintQueue (PrintQueueService) - 任务队列
├── IFileConverterFactory - 转换器工厂
├── IPrintService (PrintService) - 打印服务
├── IFileArchiver (FileArchiver) - 文件归档
└── ITrayIconService (TrayIconService) - 托盘图标
```

### 3. 处理流程
```
文件监控 → 事件防抖 → 任务聚合 → 格式转换 → PDF合并 → 用户选择 → 打印执行 → 文件归档
```

## 🛠️ 技术栈

### 核心技术
- **.NET 8.0 + C# 12.0**
- **Windows Forms** (UI框架)
- **TPL Dataflow** (BufferBlock<T>)
- **System.IO.Abstractions** (可测试性)

### 第三方库
- **Syncfusion.DocIO** (文档转换)
- **Serilog** (日志记录)
- **IronPDF** (PDF打印)

## 📊 服务注册表

| 接口 | 实现 | 生命周期 | 描述 |
|------|------|----------|------|
| IHostedService | PrintProcessorService | Singleton | 主处理服务 |
| IFileMonitor | FileMonitorService | Singleton | 文件监控 |
| IPrintQueue | PrintQueueService | Singleton | 任务队列 |
| IFileConverterFactory | FileConverterFactory | Singleton | 转换器工厂 |
| IFileConverter | WordToPdfConverter | Transient | Word转换 |
| IFileConverter | ExcelToPdfConverter | Transient | Excel转换 |
| IFileConverter | ImageToPdfConverter | Transient | 图片转换 |
| IPrintService | PrintService | Singleton | 打印服务 |
| IFileArchiver | FileArchiver | Singleton | 文件归档 |
| IFileSystem | FileSystem | Singleton | 文件系统抽象 |
| ITrayIconService | TrayIconService | Singleton | 托盘图标 |
| SettingsForm | SettingsForm | Transient | 配置界面 |
| PrinterSelectionForm | PrinterSelectionForm | Transient | 打印机选择 |

## ⚙️ 配置项

### 监控配置
- `ApplicationSettings:Monitoring:Path` - 监控文件夹路径
- `ApplicationSettings:Monitoring:DebounceIntervalMilliseconds` - 防抖间隔

### 打印配置
- `ApplicationSettings:Printing:ExcludedPrinters` - 排除的打印机

### 归档配置
- `ApplicationSettings:Archiving:SubdirectoryFormat` - 归档目录格式

### 日志配置
- `Serilog:WriteTo:0:Args:path` - 日志文件路径
- `Serilog:WriteTo:0:Args:retainedFileTimeLimit` - 日志保留时间

## 🧪 测试策略

### 可测试性设计
- 所有外部依赖通过接口抽象
- 使用System.IO.Abstractions模拟文件系统
- 依赖注入支持Mock对象替换

### 测试框架
- **xUnit** 或 **NUnit** (测试框架)
- **Moq** 或 **NSubstitute** (模拟框架)
- **System.IO.Abstractions.TestingHelpers** (文件系统模拟)

## 📝 编码标准

### 核心原则
1. **架构一致性**：严格遵循规划书设计
2. **可测试性**：所有依赖通过接口注入
3. **文档完整性**：完整的XML注释
4. **UTF-8 BOM编码**：防止中文乱码

### 关键模式
- **构造函数注入**：避免静态依赖
- **异步编程**：使用async/await
- **资源管理**：使用using语句
- **错误处理**：具体异常类型

## 🔄 开发流程

### 1. 开发前准备
- [ ] 阅读相关规划书章节
- [ ] 确认架构设计要求
- [ ] 制定实施计划
- [ ] 准备测试策略

### 2. 开发过程
- [ ] 遵循编码标准
- [ ] 实现接口定义
- [ ] 编写单元测试
- [ ] 添加文档注释

### 3. 开发完成
- [ ] 代码审查
- [ ] 测试验证
- [ ] 文档更新
- [ ] 版本控制

## 📋 关键检查点

### 架构一致性
- [ ] 是否遵循了规划书中的设计模式？
- [ ] 是否使用了正确的依赖注入方式？
- [ ] 是否实现了规划书中定义的接口？

### 可测试性
- [ ] 所有外部依赖是否都已抽象化？
- [ ] 是否避免了静态依赖？
- [ ] 是否可以通过依赖注入进行测试？

### 代码质量
- [ ] 是否有完整的XML文档注释？
- [ ] 是否遵循了命名规范？
- [ ] 是否正确处理了异常？
- [ ] 是否正确管理了资源？

## 🚨 重要提醒

1. **规划书是权威**：所有技术决策必须基于规划书
2. **架构一致性**：代码实现必须与规划书设计一致
3. **可测试性**：每个模块都必须可进行单元测试
4. **文档完整**：每个类和方法都必须有完整注释
5. **版本控制**：规划书变更需要严格的版本管理

## 📚 相关文档

- [项目规划书](../托盘打印助手PrintAssistant项目规划01.md) - 总纲性文件
- [开发实施检查清单](implementation/开发实施检查清单.md) - 实施指导
- [编码标准与规范](standards/编码标准与规范.md) - 编码规范
- [项目总纲版本控制](architecture/项目总纲版本控制.md) - 版本管理

---

**记住**：这份规划书是项目成功的基石，请务必严格遵循其指导原则！
